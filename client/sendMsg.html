<!DOCTYPE html>
<html>
<head>
<title>MozillaBall</title>
<link rel="stylesheet" type="text/css" href="http://localhost:8000/css/chico-min-0.13.1.css">
<style>
</style>
<script>


</script>
</head>

<body>

<form class="ch-form ch-box"  method="GET">
	<p class="ch-form-subtitle">
		<label id="hiUser" for="text"></label>
	</p>
	<p class="ch-form-row">
		<input id="msg" type="text" />
		<input class="ch-btn ch-btn-big" type="submit" value="Send" />
</form>


</body>
<script src="http://localhost:8000/js/jquery-1.4.2.min.js"></script>
<script src="http://localhost:8000/js/chico-min-0.13.1.js"></script>

<!-- <script src="https://myapps.mozillalabs.com/jsapi/include.js"></script> -->
<script>

var nickname = 'user';

$(document).ready(function() {
	nickname = sessionStorage.getItem("nickname");
	$('#hiUser').text("Hi " + nickname + ",") ;
	checkMsgs(nickname);

	initWorker();
});

function send(){
	var msg = $('#msg').val();
	$('#msg').val("");
	var msg = {
            name: "gonzalo",
           	message: "puto el que lee"
    }
    try{
	$.ajax({
         url:    'http://10.255.180.102:9000/messages',
         type: 'POST',
         dataType: 'json',
         data: msg
		}).done(function( msg ) {
			alert( "Data Saved: " + msg );
		});
		alert("bla");
	}catch(err){
		console.log("error:" + err);
	}

}

var checkMsgs = function(){
    jQuery.ajax({
         url:    'http://10.255.180.102:9000/'+nickname+'/isMention',
         success: function(result) {
                    if(result == "true"){
                          alert("Tienes un mensaje!");
                          var snd = new Audio("ah.wav"); // buffers automatically when created
                          snd.play();
                          }
                  }
    });     
  

};

var worker;

function initWorker(){
	setTimeout(function(){
		// Consulto si tengo msgs
		checkMsgs();

		//vuelvo a llamarme 
		initWorker();
	}, 2000);

}


$("#sendmsg").click(function(){
	send();
	return false;
})

</script>

</html>